
"use strict";
window.addEventListener("DOMContentLoaded", () => {
const form = document.querySelector(".form");
const submitBtn = form.querySelector(".submit-input")
const alarm = form.querySelector(".alarm-span");

const popup = document.querySelector(".popup");
const closeBtn = popup.querySelector("#closeBtn");
const formInput = form.querySelector(".form-input");

alarm.classList.add("display-none");

formInput.addEventListener("focus", (e) => {
  e.preventDefault();
  formInput.classList.remove("invalid-input");
  

});
formInput.addEventListener("input", (e) => {
  e.preventDefault();
  submitBtn.classList.remove("disabledBtn");
  alarm.classList.add("display-none");


});

function validate(input) {
  let value = input.value;
  let validEmail = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(
    input.value
  );

  if (value.length != 0 && validEmail) {
      return true;
  }
}
function clearInputs(input) {
  alarm.classList.add("display-none");
  input.value = '';
}
function showPopup() {
  popup.classList.remove("display-none");
}
function hidePopup() {
  popup.classList.add("display-none");
  clearInputs(formInput);
}
hidePopup();

async function sendData(event) {
  event.preventDefault();
    if (!validate(formInput)) {
      alarm.classList.remove("display-none");
      formInput.classList.add("invalid-input");
      submitBtn.classList.add("disabledBtn");
    } else {
      const inputData = new FormData(form);
      
      inputData.set("author", "John Dow");
      await fetch("https://sofyapim.github.io/newsletter-sign-up/", {
        method: "POST",
        body: inputData,
      })
        .then((res) => {
          // del ! if sever is true
          if (!res.ok) {
            showPopup();
            console.log;
            closeBtn.addEventListener("click", hidePopup);
            popup.addEventListener("click", hidePopup);
             
          } else {
            console.log("res - NOT OK");
          }
        })
        .then((res) => console.log(res));
    }
   
}

form.addEventListener("submit", sendData);
});

//see data
//  1
//  for (let data of formdata){
//     console.log(data);
//  }
// 2
// const emaailvalue  = formdata.get("email");
// console.log(emaailvalue);
